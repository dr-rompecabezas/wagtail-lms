{% extends "base.html" %}
{% load wagtailcore_tags lms_tags %}

{% block content %}
<div class="{% css_class 'container' %}">
    <div class="{% css_class 'row' %}">
        <div class="{% css_class 'col_main' %}">
            {% block course_header %}
            <h1>{{ page.title }}</h1>

            {% if page.description %}
                <div class="course-description">
                    {{ page.description|richtext }}
                </div>
            {% endif %}
            {% endblock course_header %}

            {% block course_content %}
            {% if page.scorm_package %}
                <div class="scorm-course-info">
                    <h3>Course Content</h3>
                    <p><strong>Package:</strong> {{ page.scorm_package.title }}</p>
                    {% if page.scorm_package.description %}
                        <p>{{ page.scorm_package.description }}</p>
                    {% endif %}
                </div>

                {% block enrollment_section %}
                {% if user.is_authenticated %}
                    {% if enrollment %}
                        <div class="enrollment-status">
                            <div class="{% css_class 'alert_info' %}">
                                <strong>Enrolled:</strong> {{ enrollment.enrolled_at|date:"M d, Y" }}
                                {% if progress %}
                                    <br><strong>Progress:</strong> {{ progress.completion_status|title }}
                                    {% if progress.score_raw %}
                                        <br><strong>Score:</strong> {{ progress.score_raw }}
                                        {% if progress.score_max %}/ {{ progress.score_max }}{% endif %}
                                    {% endif %}
                                {% endif %}
                            </div>
                            {% block course_action_button %}
                            <a href="{% url 'wagtail_lms:scorm_player' page.id %}" class="{% css_class 'btn_primary' %} {% css_class 'btn_lg' %}">
                                {% if progress.completion_status == 'completed' %}
                                    Review Course
                                {% else %}
                                    {% if progress %}Continue Course{% else %}Start Course{% endif %}
                                {% endif %}
                            </a>
                            {% endblock course_action_button %}
                        </div>
                    {% else %}
                        <div class="enrollment-actions">
                            {% block enrollment_button %}
                            <a href="{% url 'wagtail_lms:enroll_course' page.id %}" class="{% css_class 'btn_success' %} {% css_class 'btn_lg' %}">
                                Enroll in Course
                            </a>
                            {% endblock enrollment_button %}
                        </div>
                    {% endif %}
                {% else %}
                    <div class="{% css_class 'alert_warning' %}">
                        Please login to enroll in this course.
                    </div>
                {% endif %}
                {% endblock enrollment_section %}
            {% else %}
                <div class="{% css_class 'alert_warning' %}">
                    This course doesn't have any content assigned yet.
                </div>
            {% endif %}
            {% endblock course_content %}
        </div>

        <div class="{% css_class 'col_sidebar' %}">
            {% block course_sidebar %}
            <div class="course-sidebar">
                <h4>Course Information</h4>
                {% if page.scorm_package %}
                    <ul class="{% css_class 'list_unstyled' %}">
                        <li><strong>Type:</strong> SCORM {{ page.scorm_package.version }}</li>
                        <li><strong>Added:</strong> {{ page.scorm_package.created_at|date:"M d, Y" }}</li>
                    </ul>
                {% endif %}
            </div>
            {% endblock course_sidebar %}
        </div>
    </div>
</div>
{% endblock %}
